---
title: "Liver Lipids diet data: sheet3"
output: html_document
date: "2023-07-19"
params:
  echo: no
  rootdir: Z:/General/founder_diet_study

---

```{r}
library(tidyr)
library(readxl)
library(tidyverse)
library(foundr)
```

```{r}
harmonizeddir <- file.path(params$rootdir, "HarmonizedData")
harmonizeddir
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
knitr::opts_knit$set(root.dir = harmonizeddir)
```

```{r}
harmonizeddir <- "."
rawdir <- "../RawData"
getwd()
```

```{r}
links <- read.csv(file.path("..", "RawData", "source.csv"), fill = TRUE,quote="") %>%
  mutate(address = file.path(rawdir, address))
```

```{r}
annot <- read_excel("Z:\\General\\founder_diet_study\\Primary data from Mark\\mouse annotations for founder diet study.xlsx") %>%
  mutate(diet = ifelse(as.character(diet_no) == "200339", "HC_LF", "HF_LC"))
rawdir <- ""
```

```{r}
LiverLipHarmony <- function(dataset, annot, links...) {
  
  #filename <- linkpath(dataset, links)

  # Get trait names from third sheet
  traits <- unlist(read_excel(dataset, sheet = 3,
                            skip = 0, n_max = 1, col_names = FALSE)[1,])
  traits <- traits[!is.na(traits)]
  names(traits) <- NULL

  # Get data from the third sheet 
  out <- read_excel(filename, sheet = 3, skip = 0,
                  .name_repair = "minimal")
  
  # Subset the dataset
  out <- out[, -c(2:14)]


  # Add diet column
  out <- left_join(
    out,
    annot %>%
      rename(animal = "number", condition = "diet") %>%
      select(mouse_id, strain, animal, sex, condition),
    by = "mouse_id"
  )

  # Read data and pivot to longer format
  out <- out %>%
    pivot_longer(cols = !c(mouse_id, `Total Protein (Âµg)`,`Tissue Mass (mg)`, strain, animal, sex, condition),
                 names_to = "lipids", values_to = "value")

}

```

```{r}
############ TESTING

dataset<-"Z:\\General\\founder_diet_study\\Primary data from Mark\\HollandW AtkinsonD 20230327 founder LIVER LIPIDS.xlsx"

head(LiverLipHarmony(dataset,annot,links))

```
